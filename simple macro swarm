--// WindUI Loader
local WindUI = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()

--// Main Window
local Window = WindUI:CreateWindow({
    Title = "Bucko Bee (LEGIT)",
    Icon = "",
    Author = "Onett",

    Size = UDim2.fromOffset(580, 460),
    MinSize = Vector2.new(560, 350),
    MaxSize = Vector2.new(850, 560),
    Transparent = true,
    Theme = "Dark",
    Resizable = true,
    SideBarWidth = 150,
    BackgroundImageTransparency = 0.42,
    HideSearchBar = false,
    ScrollBarEnabled = false,
})

Window:Divider()

--// Sections & Tabs
local Section = Window:Section({
    Title = "Main",
    Icon = "",
    Opened = true,
})

local Main = Section:Tab({ Title = "Main", Icon = "sword" })
local Utility = Section:Tab({ Title = "Utility", Icon = "tool-case" })
local Render = Section:Tab({ Title = "Render", Icon = "eye" })

--// Task System
local TaskFlags = {}

function Task(name, func)
    if TaskFlags[name] then return end
    TaskFlags[name] = true
    task.spawn(function()
        while TaskFlags[name] do
            func()
            task.wait(0.1)
        end
    end)
end

function Stop(name)
    TaskFlags[name] = false
end

--// Core Variables
local waypointZ = {
    CFrame.new(-111.43, 4.91, 271.17),
    CFrame.new(-108.97, 4, 172.42),
    CFrame.new(-2.99, 4.26, 171.27),
    CFrame.new(-2.73, 20, 41.23),
    CFrame.new(-133.41, 20, 56.90),
}

local PFS = game:GetService("PathfindingService")
local Player = game.Players.LocalPlayer
local Character = Player.Character or Player.CharacterAdded:Wait()
local HRP = Character:WaitForChild("HumanoidRootPart")
local Humanoid = Character:WaitForChild("Humanoid")

_G.WalkE = false
_G.Token = false
local Field

--// Utility Functions
local function GetDist(p1, p2)
    return (p1 - p2).Magnitude
end

local function Nearest(area)
    local nearest, dist = nil, math.huge
    for _, cf in pairs(waypointZ) do
        local mag = (cf.Position - area.Position).Magnitude
        if mag < dist then
            dist, nearest = mag, cf
        end
    end
    return nearest, dist
end

local function Go(area)
    local path = PFS:CreatePath({ AgentCanJump = true })
    path:ComputeAsync(HRP.Position, area.Position)

    if path.Status ~= Enum.PathStatus.Success then
        return false
    end

    for _, wp in pairs(path:GetWaypoints()) do
        if wp.Action == Enum.PathWaypointAction.Jump then
            Humanoid.Jump = true
        end
        Humanoid:MoveTo(wp.Position)
        Humanoid.MoveToFinished:Wait()
    end

    return true
end

local function GetPoint()
    if not Field then return end
    local size, cf = Field.Size, Field.CFrame
    local x = math.random(-size.X / 2, size.X / 2)
    local z = math.random(-size.Z / 2, size.Z / 2)
    return cf:PointToWorldSpace(Vector3.new(x, 0, z))
end

--// UI Dropdowns and Toggles
local Dropdown = Main:Dropdown({
    Title = "Field",
    Desc = "Choose your field",
    Values = {
        "Mushroom Field", "Sunflower Field", "Dandelion Field", "Clover Field",
        "Blue Flower Field", "Spider Field", "Strawberry Field", "Bamboo Field",
        "Pineapple Patch", "Cactus Field", "Pumpkin Patch", "Pine Tree Forest"
    },
    Value = "Mushroom Field",
    Callback = function(option)
        Field = workspace.FlowerZones:WaitForChild(option)
    end,
})

local TokenToggle = Main:Toggle({
    Title = "Walk To Token",
    Desc = "Random position to walk in field",
    Icon = "check",
    Type = "Checkbox",
    Value = false,
    Callback = function(state)
        _G.Token = state
    end,
})

local WalkToggle = Main:Toggle({
    Title = "Farm",
    Desc = "Walks randomly around your selected field",
    Icon = "check",
    Type = "Checkbox",
    Value = false,
    Callback = function(state)
        _G.WalkE = state
        if not _G.WalkE then
            return Stop("Walk")
        end

        Task("Walk", function()
            if not Field then return end
            local near = Nearest(Field)
            if near then
                local success = Go(near)
                if success then
                    GetPoint()
                end
            end
        end)
    end,
})

--// Auto Click
do
    local VU = game:GetService("VirtualUser")
    _G.Enable = false

    local ClickToggle = Main:Toggle({
        Title = "Enable Click",
        Desc = "Automatically clicks for you",
        Icon = "check",
        Type = "Checkbox",
        Value = false,
        Callback = function(state)
            _G.Enable = state

            if not _G.Enable then
                Stop("Click")
                return
            end

            Task("Click", function()
                VU:Button1Down(Vector2.new(0.9, 0.9))
                VU:Button1Up(Vector2.new(0.9, 0.9))
            end)
        end,
    })
end
