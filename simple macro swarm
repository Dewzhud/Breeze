-- Load WindUI
local WindUI = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()

-- Create Window
local Window = WindUI:CreateWindow({
    Title = "Bucko Bee (LEGIT)",
    Icon = "",
    Author = "Onett",
    Size = UDim2.fromOffset(580, 460),
    MinSize = Vector2.new(560, 350),
    MaxSize = Vector2.new(850, 560),
    Transparent = true,
    Theme = "Dark",
    Resizable = true,
    SideBarWidth = 150,
    BackgroundImageTransparency = 0.42,
    HideSearchBar = false,
    ScrollBarEnabled = false,
})

Window:Divider()

-- Create Sections and Tabs
local Section = Window:Section({ Title = "Main", Icon = "", Opened = true })

local Main = Section:Tab({ Title = "Main", Icon = "sword", Locked = false })
local Utility = Section:Tab({ Title = "Utility", Icon = "tool-case", Locked = false })
local Render = Section:Tab({ Title = "Render", Icon = "eye", Locked = false })

-- Task management
local TaskFlags = {}
function Task(name, func)
    if TaskFlags[name] then return end
    TaskFlags[name] = true
    task.spawn(function()
        while TaskFlags[name] do
            func()
            task.wait(0.1)
        end
    end)
end

function Stop(name)
    TaskFlags[name] = false
end

-- Utility functions
local function GetDist(p1, p2)
    return (p1 - p2).Magnitude
end

-- Waypoints
local waypointZ = {
    CFrame.new(-111.430428, 4.91108656, 271.171844), -- spawn
    CFrame.new(-108.973328, 3.99999976, 172.421021), -- corner
    CFrame.new(-2.99104142, 4.26106167, 171.278656),
    CFrame.new(-2.73469853, 19.9999981, 41.236969), -- front lv 15 door
    CFrame.new(-133.415436, 19.9999981, 56.9060936), -- Strawberry Field
}

-- Services and Player references
local Players = game:GetService("Players")
local PFS = game:GetService("PathfindingService")
local Me = Players.LocalPlayer.Character:WaitForChild("HumanoidRootPart")
local Hum = Players.LocalPlayer.Character:WaitForChild("Humanoid")

-- Globals
_G.WalkE = false
_G.Token = false
local Field

-- Pathfinding Helpers
local function Nearest(area)
    local nearest, dist = nil, math.huge
    for _, n in pairs(waypointZ) do
        local mag = (n.Position - area.Position).Magnitude
        if mag < dist then
            dist, nearest = mag, n
        end
    end
    return nearest, dist
end

local function Go(area)
    local path = PFS:CreatePath({ AgentCanJump = true })
    path:ComputeAsync(Me.Position, area.Position)

    if path.Status ~= Enum.PathStatus.Success then
        return false
    end

    for _, wp in pairs(path:GetWaypoints()) do
        if wp.Action == Enum.PathWaypointAction.Jump then
            Hum.Jump = true
        end
        Hum:MoveTo(wp.Position)
        if not Hum.MoveToFinished:Wait() then
            return false
        end
    end
    return true
end

local function GetPoint()
    local Size = Field.Size
    local Cf = Field.CFrame
    local x = math.random(-Size.X / 2, Size.X / 2)
    local z = math.random(-Size.Z / 2, Size.Z / 2)
    return Cf:PointToWorldSpace(Vector3.new(x, 0, z))
end

-- Field Dropdown
Main:Dropdown({
    Title = "Field",
    Desc = "Choose your field",
    Values = {
        "Mushroom Field", "Sunflower Field", "Dandelion Field", "Clover Field",
        "Blue Flower Field", "Spider Field", "Strawberry Field", "Bamboo Field",
        "Pineapple Patch", "Cactus Field", "Pumpkin Patch", "Pine Tree Forest",
        "Rose Field", "Mountain Top Field",
    },
    Value = "Mushroom Field",
    Callback = function(option)
        Field = workspace.FlowerZones:WaitForChild(option)
    end
})

-- Walk to Token Toggle
Main:Toggle({
    Title = "Walk To Token",
    Desc = "Random pos to walk in field",
    Icon = "check",
    Type = "Checkbox",
    Value = false,
    Callback = function(state)
        _G.Token = state
    end
})

-- Farm Toggle
Main:Toggle({
    Title = "Farm",
    Desc = "Random pos to walk in field",
    Icon = "check",
    Type = "Checkbox",
    Value = false,
    Callback = function(state)
        _G.WalkE = state
        if not _G.WalkE then return Stop("Walk") end

        Task("Walk", function()
            if not Field then return end
            local near = Nearest(Field)
            local core = Players.LocalPlayer.CoreStats
            local Cap = core.Capacity
            local Pollen = core.Pollen

            if Pollen.Value == Cap.Value then
                print("Full")
            else
                if near then
                    local Suc = Go(near)
                    if Suc then
                        local WalkE = GetPoint()
                        Hum:MoveTo(WalkE)
                    end
                end
            end
        end)
    end
})

-- Click Automation Toggle
Main:Toggle({
    Title = "Enable Click",
    Desc = "ALWAYS LEGIT",
    Icon = "check",
    Type = "Checkbox",
    Value = false,
    Callback = function(state)
        _G.Enable = state
        if not _G.Enable then
            game:GetService("VirtualUser"):Button1Down(Vector2.new(0.9, 0.9))
            game:GetService("VirtualUser"):Button1Up(Vector2.new(0.9, 0.9))
            return Stop("Click")
        end

        Task("Click", function()
            game:GetService("VirtualUser"):Button1Down(Vector2.new(0.9, 0.9))
            game:GetService("VirtualUser"):Button1Up(Vector2.new(0.9, 0.9))
        end)
    end
})
